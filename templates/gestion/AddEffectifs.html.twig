{% extends 'base.html.twig' %}

{% block title %}Ajouter un Effectif{% endblock %}

{% block body %}
<main class="main-content border-radius-lg">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-12">
        <div class="card z-index-0 fadeIn3 fadeInBottom">
          <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
            <div class="bg-gradient-dark shadow-dark border-radius-lg py-3 pe-1">
              <h4 class="text-white font-weight-bolder text-center mt-2 mb-0">Ajouter un Effectif</h4>
            </div>
          </div>
          <div class="card-body">
            {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}

            <div class="row">
              <div class="col-md-6">
                <div class="input-group input-group-outline my-3">
                  {{ form_label(form.nom, 'Nom', {'label_attr': {'class': 'form-label'}}) }}
                  {{ form_widget(form.nom, {'attr': {'class': 'form-control', 'placeholder': 'Nom'}}) }}
                  {{ form_errors(form.nom) }}
                </div>
              </div>
              <div class="col-md-6">
                <div class="input-group input-group-outline my-3">
                  {{ form_label(form.prenom, 'Prénom', {'label_attr': {'class': 'form-label'}}) }}
                  {{ form_widget(form.prenom, {'attr': {'class': 'form-control', 'placeholder': 'Prénom'}}) }}
                  {{ form_errors(form.prenom) }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="input-group input-group-outline my-3">
                  {{ form_label(form.poste, 'Poste', {'label_attr': {'class': 'form-label'}}) }}
                  {{ form_widget(form.poste, {'attr': {'class': 'form-control', 'placeholder': 'Poste'}}) }}
                  {{ form_errors(form.poste) }}
                </div>
              </div>
              <div class="col-md-6">
                <div class="input-group input-group-outline my-3">
                  {{ form_label(form.email, 'Email', {'label_attr': {'class': 'form-label'}}) }}
                  {{ form_widget(form.email, {'attr': {'class': 'form-control', 'placeholder': 'Email'}}) }}
                  {{ form_errors(form.email) }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="input-group input-group-outline my-3">
                  {{ form_label(form.telephone, 'Téléphone', {'label_attr': {'class': 'form-label'}}) }}
                  {{ form_widget(form.telephone, {'attr': {'class': 'form-control', 'placeholder': 'Téléphone'}}) }}
                  {{ form_errors(form.telephone) }}
                </div>
              </div>
              <div class="col-md-6">
                <div class="input-group input-group-outline my-3">
                  {{ form_label(form.num_cin, 'Numéro CIN', {'label_attr': {'class': 'form-label'}}) }}
                  {{ form_widget(form.num_cin, {'attr': {'class': 'form-control', 'placeholder': 'Numéro CIN'}}) }}
                  {{ form_errors(form.num_cin) }}
                </div>
              </div>
            </div>

            <div class="input-group input-group-outline my-3">
              {{ form_label(form.id_ref, 'Référence Ressources Humaines', {'label_attr': {'class': 'form-label'}}) }}
              {{ form_widget(form.id_ref, {'attr': {'class': 'form-control'}}) }}
              {{ form_errors(form.id_ref) }}
            </div>

           <div class="input-group input-group-outline my-3">
  <label for="wilaya-select" class="form-label">Choisir une Wilaya</label>
  <select id="wilaya-select" class="form-control" onchange="updateLocalisation()">
    <option value="">-- Sélectionnez une Wilaya --</option>
    {# Options générées via JS #}
  </select>
</div>

            {# Champ localisation readonly rempli par JS #}
            <div class="input-group input-group-outline my-3">
              {{ form_label(form.localisation, 'Localisation (lat,lng)', {'label_attr': {'class': 'form-label'}}) }}
              {{ form_widget(form.localisation, {'attr': {'class': 'form-control', 'placeholder': 'Ex: 36.8065,10.1815', 'readonly': 'readonly'}}) }}
              {{ form_errors(form.localisation) }}
            </div>

            {# Champ image upload #}
            <div class="input-group input-group-outline my-3">
              {{ form_label(form.image_effect, 'Photo de l\'effectif', {'label_attr': {'class': 'form-label'}}) }}
              {{ form_widget(form.image_effect, {'attr': {'class': 'form-control', 'accept': 'image/*'}}) }}
              {{ form_errors(form.image_effect) }}
            </div>

            <div class="text-center">
              <button type="submit" class="btn bg-gradient-dark w-100 my-4 mb-2">Enregistrer</button>
              <a href="{{ path('list_effectifs') }}" class="btn btn-secondary w-100 mb-2">Annuler</a>
            </div>

            {{ form_end(form) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  const gouvernoratsTunisie = {
    "Ariana": [36.8662, 10.1647],
    "Béja": [36.7256, 9.1819],
    "Ben Arous": [36.7455, 10.2433],
    "Bizerte": [37.2746, 9.8739],
    "Gabès": [33.8811, 10.0986],
    "Gafsa": [34.4253, 8.7841],
    "Jendouba": [36.5010, 8.7801],
    "Kairouan": [35.6781, 10.0963],
    "Kasserine": [35.1678, 8.8377],
    "Kébili": [33.7045, 8.9689],
    "Le Kef": [36.1661, 8.7042],
    "Mahdia": [35.5031, 11.0622],
    "La Manouba": [36.8172, 10.0895],
    "Médenine": [33.3547, 10.5067],
    "Monastir": [35.7774, 10.8267],
    "Nabeul": [36.4569, 10.7369],
    "Sfax": [34.7406, 10.7603],
    "Sidi Bouzid": [35.0341, 9.4880],
    "Siliana": [36.0836, 9.3640],
    "Sousse": [35.8256, 10.6084],
    "Tataouine": [32.9339, 10.4515],
    "Tozeur": [33.9203, 8.1331],
    "Tunis": [36.8065, 10.1815],
    "Zaghouan": [36.4006, 10.1425]
  };

  function updateLocalisation() {
    const select = document.getElementById('wilaya-select');
    const locInput = document.getElementById('{{ form.localisation.vars.id }}');
    const wilaya = select.value;
    if (wilaya && gouvernoratsTunisie[wilaya]) {
      const coords = gouvernoratsTunisie[wilaya];
      locInput.value = coords[0] + ',' + coords[1];
    } else {
      locInput.value = '';
    }
  }

  // Générer les options du select au chargement de la page
  document.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('wilaya-select');
    for (const wilaya in gouvernoratsTunisie) {
      if (gouvernoratsTunisie.hasOwnProperty(wilaya)) {
        const option = document.createElement('option');
        option.value = wilaya;
        option.textContent = wilaya;
        select.appendChild(option);
      }
    }
  });
</script>

{% endblock %}